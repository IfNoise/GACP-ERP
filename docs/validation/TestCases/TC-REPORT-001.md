---
title: "Compliance Reporting Generation & Validation"
module: "Reporting & Compliance"
urs_id: "URS-REPORT-001"
fs_id: "FS-REPORT-001"
ds_id: "DS-REPORT-001"
iq_oq_pq_step: "OQ-REPORT-001"
version: "1.0"
status: "active"
last_updated: "2025-10-15"
test_priority: "Critical"
regulatory_impact: "Critical - WHO GACP, EU GMP Annex 11, FDA 21 CFR Part 11"
# AI-Assisted Documentation Metadata (per AI_Assisted_Documentation_Policy.md)
ai_generated: true
author_verified: false
qa_approved: false
ai_status: draft
---

# TC-REPORT-001: Compliance Reporting Generation & Validation

## 1. Purpose

Проверка корректной генерации, валидации и экспорта compliance отчетов в соответствии с требованиями WHO GACP, EU GMP и FDA 21 CFR Part 11, включая:
- Plant Lifecycle Reports
- Audit Trail Reports  
- Batch History Records
- Compliance Summary Reports
- Electronic signatures validation

**Regulatory Requirements:**
- WHO GACP - Complete batch traceability
- EU GMP Annex 11 - Audit trail reporting
- FDA 21 CFR Part 11 - Electronic records and signatures
- Data Integrity (ALCOA+) - Attributable, Legible, Contemporaneous, Original, Accurate

## 2. Scope

**Тестируемая функциональность:**
- Генерация различных типов отчетов
- Фильтрация и параметризация отчетов
- Валидация данных в отчетах
- Watermarking для аудиторского экспорта
- Electronic signatures в отчетах
- Export в PDF/Excel форматы
- Audit trail для действий с отчетами

## 3. Preconditions

### 3.1 System State
- ✅ GACP-ERP система запущена
- ✅ PDF Report Generator сервис активен
- ✅ Database содержит тестовые данные (минимум 30 дней истории)
- ✅ Audit Consumer сервис записывает события

### 3.2 Test Data
- **Batch ID**: BATCH-2025-001 (завершенная партия)
- **Plant IDs**: PLANT-001 to PLANT-100 (в составе BATCH-2025-001)
- **Audit Events**: >500 записей за последние 30 дней
- **E-Signatures**: >20 подписанных документов

### 3.3 Users
- **Compliance Officer**: `compliance@gacp-test.com` / `Test123!`
  - Права: `reports:generate`, `reports:export`, `reports:sign`, `audit:view`
- **Auditor**: `auditor@gacp-test.com` / `Test123!`
  - Права: `reports:view`, `reports:export_watermarked`, `audit:view`

### 3.4 Required Reports Configuration
- Plant Lifecycle Report Template активен
- Audit Trail Report Template активен
- Batch History Report Template активен
- Compliance Summary Report Template активен

## 4. Test Steps

### Step 1: Вход в систему как Compliance Officer

**Action:**
```
1.1. Открыть URL: https://gacp-erp.test/login
1.2. Ввести email: compliance@gacp-test.com
1.3. Ввести password: Test123!
1.4. Нажать "Sign In"
```

**Expected Result:**
- ✅ Успешная аутентификация
- ✅ Dashboard отображается
- ✅ Меню "Reports" доступно
- ✅ Audit trail: LOGIN event записан

---

### Step 2: Навигация к модулю Reports

**Action:**
```
2.1. Кликнуть "Reports" в главном меню
2.2. Выбрать "Compliance Reports"
```

**Expected Result:**
- ✅ Отображается список доступных типов отчетов:
  - Plant Lifecycle Report
  - Audit Trail Report
  - Batch History Record
  - Compliance Summary Report
  - Training Report
  - Deviation Report
- ✅ Для каждого отчета показан статус шаблона: "Active"

---

### Step 3: Генерация Plant Lifecycle Report

**Action:**
```
3.1. Выбрать "Plant Lifecycle Report"
3.2. Установить параметры:
    - Batch ID: BATCH-2025-001
    - Date Range: [start_date] - [end_date]
    - Include Photos: Yes
    - Include Measurements: Yes
    - Include Events: Yes
3.3. Нажать "Generate Report"
```

**Expected Result:**
- ✅ Progress bar показывает генерацию: 0% → 100%
- ✅ Время генерации < 10 секунд
- ✅ Отчет сгенерирован и отображается preview
- ✅ Отчет содержит секции:
  - **Header**: Report Title, Date, Batch ID, Generated by
  - **Batch Summary**: Start date, end date, total plants, completion status
  - **Plant Details**: Таблица с 100 растениями
    - Plant Code
    - Strain
    - Germination Date
    - Transplant Dates
    - Growth Stages
    - Health Scores
    - Harvest Date
    - Final Yield
  - **Events Timeline**: Все события для растений
  - **Photos**: Прикрепленные фотографии (если есть)
  - **Measurements**: График роста и параметры
  - **Footer**: Page numbers, generation timestamp
- ✅ Данные соответствуют записям в БД (выборочная проверка 10 растений)

---

### Step 4: Валидация данных Plant Lifecycle Report

**Action:**
```
4.1. Выбрать случайное растение PLANT-042 из отчета
4.2. Открыть в отдельной вкладке: Plant Details (PLANT-042)
4.3. Сравнить данные:
    - Germination Date
    - Transplant History
    - Health Score History
    - Final Yield
```

**Expected Result:**
- ✅ Все данные в отчете точно совпадают с Plant Details
- ✅ Timestamps совпадают
- ✅ Вычисленные метрики (average health score) корректны
- ✅ ALCOA+ compliance:
  - Attributable: показан author каждого события
  - Legible: все данные читаемы
  - Contemporaneous: timestamps актуальны
  - Original: данные из первоисточника (БД)
  - Accurate: валидация подтверждена

---

### Step 5: Export Plant Lifecycle Report в PDF

**Action:**
```
5.1. Нажать "Export to PDF"
5.2. Подождать генерации PDF
5.3. Скачать файл
5.4. Открыть PDF в viewer
```

**Expected Result:**
- ✅ PDF файл сгенерирован за < 5 секунд
- ✅ Имя файла: `Plant_Lifecycle_Report_BATCH-2025-001_2025-10-15.pdf`
- ✅ PDF содержит:
  - Все секции из preview
  - Корректное форматирование таблиц
  - Встроенные изображения (photos)
  - Графики в высоком разрешении
  - Header/Footer на каждой странице
  - Table of Contents
  - Digital signature metadata (SHA-256 hash)
- ✅ PDF размер < 10 MB
- ✅ PDF/A-1 compliant (архивный формат)

---

### Step 6: Генерация Audit Trail Report

**Action:**
```
6.1. Вернуться к "Compliance Reports"
6.2. Выбрать "Audit Trail Report"
6.3. Установить параметры:
    - Batch ID: BATCH-2025-001
    - Date Range: Last 30 days
    - Event Types: ALL
    - Users: ALL
    - Tables: plants, plant_events, measurements
6.4. Нажать "Generate Report"
```

**Expected Result:**
- ✅ Отчет сгенерирован за < 15 секунд
- ✅ Отчет содержит секции:
  - **Summary**: Total events, unique users, date range
  - **Events by Type**: Bar chart
  - **Events by User**: Table
  - **Detailed Audit Trail**: Таблица всех событий
    - Timestamp
    - Table Name
    - Record ID
    - Operation (INSERT/UPDATE/DELETE)
    - Old Values
    - New Values
    - Changed By (User)
    - Session ID
    - IP Address
- ✅ Все события хронологически упорядочены
- ✅ >500 записей найдено
- ✅ Pagination работает (по 50 записей на страницу)

---

### Step 7: Фильтрация Audit Trail Report

**Action:**
```
7.1. Применить фильтры:
    - Event Type: UPDATE
    - User: specific.user@gacp-test.com
    - Table: plants
7.2. Нажать "Apply Filters"
```

**Expected Result:**
- ✅ Отчет пересчитан с новыми фильтрами
- ✅ Показаны только UPDATE операции
- ✅ Показаны только изменения от specific.user@gacp-test.com
- ✅ Показаны только изменения в таблице plants
- ✅ Счетчик событий обновлен
- ✅ Старые фильтры сохранены в UI

---

### Step 8: Генерация Batch History Record

**Action:**
```
8.1. Выбрать "Batch History Record"
8.2. Установить параметры:
    - Batch ID: BATCH-2025-001
    - Include SOPs: Yes
    - Include Deviations: Yes
    - Include CAPAs: Yes
8.3. Нажать "Generate Report"
```

**Expected Result:**
- ✅ Batch History Record сгенерирован
- ✅ Содержит complete chain of custody:
  - **Batch Information**: ID, start/end dates, status
  - **SOPs Used**: Список всех SOP, использованных в процессе
  - **Personnel**: Все сотрудники, работавшие с партией
  - **Equipment**: Все оборудование, использованное
  - **Materials**: Все материалы (seeds, nutrients, etc.)
  - **Growth Timeline**: Детальная хронология событий
  - **Quality Control**: Все QC проверки и результаты
  - **Deviations**: Список отклонений (если есть)
  - **CAPAs**: Корректирующие действия (если есть)
  - **Final Release**: Approval статус и signatures
- ✅ Все данные прослеживаемы (traceable)
- ✅ Формат соответствует WHO GACP требованиям

---

### Step 9: E-Signature на Batch History Record

**Action:**
```
9.1. Нажать "Sign Report"
9.2. Ввести password для e-signature: Test123!
9.3. Добавить комментарий: "Batch history reviewed and approved"
9.4. Подтвердить signature
```

**Expected Result:**
- ✅ E-signature применена к отчету
- ✅ Отчет помечен как "Signed"
- ✅ Signature block добавлен в отчет:
  - Signed By: compliance@gacp-test.com
  - Signed At: [timestamp]
  - Signature Hash: [SHA-256]
  - Comment: "Batch history reviewed and approved"
- ✅ Audit trail содержит REPORT_SIGNED event
- ✅ Отчет становится read-only (нельзя редактировать параметры)

---

### Step 10: Экспорт для аудитора с watermark

**Action:**
```
10.1. Logout и login как auditor@gacp-test.com
10.2. Открыть "Reports" → "Signed Reports"
10.3. Найти Batch History Record для BATCH-2025-001
10.4. Нажать "Export for Auditor"
10.5. Заполнить форму:
      - Recipient Name: John Auditor
      - Organization: FDA Inspection Team
      - Purpose: Regulatory Inspection
      - Watermark Text: CONFIDENTIAL - FOR AUDIT ONLY
10.6. Нажать "Generate Auditor Copy"
```

**Expected Result:**
- ✅ PDF сгенерирован с watermark
- ✅ На каждой странице PDF visible watermark:
  ```
  CONFIDENTIAL - FOR AUDIT ONLY
  Generated for: John Auditor (FDA Inspection Team)
  Purpose: Regulatory Inspection
  Generated by: auditor@gacp-test.com
  Generated at: [timestamp]
  ```
- ✅ Watermark прозрачный но читаемый (opacity 30%)
- ✅ В audit trail записано:
  ```
  REPORT_EXPORTED_FOR_AUDIT | Report: Batch History BATCH-2025-001 |
  Exported By: auditor@gacp-test.com | Recipient: John Auditor |
  Organization: FDA Inspection Team
  ```
- ✅ Email уведомление отправлено Compliance Officer о экспорте

---

### Step 11: Генерация Compliance Summary Report

**Action:**
```
11.1. Login обратно как compliance@gacp-test.com
11.2. Выбрать "Compliance Summary Report"
11.3. Параметры:
      - Period: Q3 2025 (July-September)
      - Include: All metrics
11.4. Генерировать отчет
```

**Expected Result:**
- ✅ Summary Report содержит KPIs:
  - **Batches Completed**: 15
  - **Batches In Progress**: 5
  - **Total Plants Processed**: 1,500
  - **Quality Metrics**: 98.5% pass rate
  - **Deviation Rate**: 2 deviations / 15 batches
  - **CAPA Completion**: 100% closed on time
  - **Training Compliance**: 95% of staff certified
  - **Audit Trail Integrity**: 100% (no gaps)
  - **SOP Compliance**: 99.2% adherence
- ✅ Каждая метрика содержит:
  - Current Value
  - Trend (vs previous period)
  - Status indicator (Green/Yellow/Red)
- ✅ Executive summary paragraph автогенерирован
- ✅ Charts and graphs включены

---

### Step 12: Scheduled Reports

**Action:**
```
12.1. Перейти в "Reports" → "Scheduled Reports"
12.2. Создать новый schedule:
      - Report Type: Compliance Summary
      - Frequency: Monthly (1st day of month)
      - Recipients: compliance@gacp-test.com, qm@gacp-test.com
      - Format: PDF
      - Auto-send: Yes
12.3. Сохранить schedule
```

**Expected Result:**
- ✅ Schedule создан и активен
- ✅ Показан next run date: [1st of next month]
- ✅ Email notification settings сохранены
- ✅ Можно просмотреть history предыдущих отправок (если есть)
- ✅ Audit trail: REPORT_SCHEDULE_CREATED

---

### Step 13: Проверка Performance метрик

**Action:**
```
13.1. Генерировать Large Report:
      - Report: Audit Trail
      - Period: Last 365 days
      - Records: >5000 events
13.2. Замерить время генерации
```

**Expected Result:**
- ✅ Report generation time < 30 секунд для 5000+ записей
- ✅ UI остается responsive (progress bar обновляется)
- ✅ Memory usage < 500 MB
- ✅ PDF size < 20 MB
- ✅ Pagination работает без задержек

## 5. Expected Results (Summary)

### Functional Requirements
- ✅ Все типы отчетов генерируются корректно
- ✅ Данные в отчетах валидны и соответствуют БД
- ✅ Фильтрация и параметризация работает
- ✅ Export в PDF/Excel успешен
- ✅ E-signatures применяются корректно
- ✅ Watermarking для аудиторов работает
- ✅ Scheduled reports настраиваются

### Compliance Requirements
- ✅ WHO GACP: Complete batch traceability обеспечена
- ✅ EU GMP Annex 11: Audit trail полный и неизменяемый
- ✅ FDA 21 CFR Part 11: E-signatures валидны, audit trail записан
- ✅ ALCOA+: Все данные Attributable, Legible, Contemporaneous, Original, Accurate
- ✅ Data Integrity: Watermarking предотвращает unauthorized use

### Performance Requirements
- ✅ Генерация стандартного отчета < 10 сек
- ✅ Генерация большого отчета < 30 сек
- ✅ PDF export < 5 сек
- ✅ UI responsive во время генерации

## 6. Actual Results

**Test Execution Date:** _________________  
**Tester:** _________________  
**Environment:** _________________

| Step | Status | Comments | Evidence |
|------|--------|----------|----------|
| 1 | ☐ Pass ☐ Fail | | |
| 2 | ☐ Pass ☐ Fail | | |
| 3 | ☐ Pass ☐ Fail | | |
| 4 | ☐ Pass ☐ Fail | | |
| 5 | ☐ Pass ☐ Fail | | |
| 6 | ☐ Pass ☐ Fail | | |
| 7 | ☐ Pass ☐ Fail | | |
| 8 | ☐ Pass ☐ Fail | | |
| 9 | ☐ Pass ☐ Fail | | |
| 10 | ☐ Pass ☐ Fail | | |
| 11 | ☐ Pass ☐ Fail | | |
| 12 | ☐ Pass ☐ Fail | | |
| 13 | ☐ Pass ☐ Fail | | |

**Overall Test Result:** ☐ PASS ☐ FAIL  
**Defects Found:** _________________

## 7. Test Evidence

**Required Attachments:**
1. Screenshots для каждого шага (13 screenshots)
2. Сгенерированные PDF отчеты (минимум 4 типа)
3. Audit trail export (CSV)
4. Watermarked auditor copy (PDF)
5. Email notifications (screenshots)
6. Performance metrics log

## 8. Cleanup

**Post-Test Actions:**
```
1. Удалить scheduled reports созданные в тесте
2. Архивировать сгенерированные отчеты
3. Очистить email queue
4. Backup audit trail записей теста
```

## 9. Approvals

| Role | Name | Signature | Date |
|------|------|-----------|------|
| Test Author | | | |
| Test Reviewer | | | |
| QA Manager | | | |
| Compliance Officer | | | |

---

**Revision History:**

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 0.1 | 2025-09-01 | Initial | Draft version |
| 1.0 | 2025-10-15 | AI Assistant | Complete detailed test case with compliance requirements |

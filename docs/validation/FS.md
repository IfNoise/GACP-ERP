---
title: "Functional Specification (FS)"
system: "ERP for GACP-Compliant Cannabis Cultivation"
version: "0.1-draft"
status: "draft"
last_updated: "2025-09-01"
---

# 1. Purpose

Документ описывает функциональные требования системы ERP для управления производством каннабиса с полным соответствием GACP/GxP. FS является прямым продолжением URS и детализирует, как каждое требование URS реализуется в функциональности.

# 2. Traceability

Каждое требование URS имеет свой FS-эквивалент:

- URS-DI-001 → FS-DI-001
- URS-DI-002 → FS-DI-002
- ...

# 3. Functional Requirements

## 3.1 Data Integrity & Audit Trail

- **FS-DI-001**: Система использует WORM-хранилище (например, MinIO + S3 Object Lock или IPFS/WORM DB) для неизменяемого хранения критических данных.
- **FS-DI-002**: Каждый пользовательский экшен логируется в Audit Trail с:
  - ID пользователя
  - Меткой времени UTC
  - Типом действия
  - Контекстом (plant ID, batch ID, equipment ID)
- **FS-DI-003**: Audit Trail доступен через API, экспорт в PDF/CSV с фильтрацией по диапазону дат, пользователю и объекту.
- **FS-DI-004**: Любая попытка редактирования данных создаёт новую запись версии, оригинал остаётся неизменным.

## 3.2 Authentication & Authorization

- **FS-AUTH-001**: Интеграция Keycloak (OIDC/SAML) для SSO с поддержкой RBAC.
- **FS-AUTH-002**: Для QA/QC и администраторов обязательна 2FA (TOTP/HOTP или аппаратные токены).
- **FS-AUTH-003**: e-Signature через QR-код на бейдже или аппаратный токен.
- **FS-AUTH-004**: Разграничение доступа по ролям, включая кастомные роли и права CRUD на сущности Plants, Batches, Equipment.

## 3.3 Electronic Signatures

- **FS-ES-001**: Каждая электронная подпись включает: имя пользователя, метку времени, причину действия.
- **FS-ES-002**: Для критических операций требуется повторная аутентификация.
- **FS-ES-003**: Подписи привязаны к конкретным действиям в Audit Trail и невозможно их удалить/подменить.

## 3.4 Plant Lifecycle Management

- **FS-PLM-001**: Каждое растение получает уникальный идентификатор (QR/RFID/barcode).
- **FS-PLM-002**: Источник растения фиксируется (seed, clone).
- **FS-PLM-003**: Этапы жизненного цикла фиксируются автоматически: Germination → Vegetation → Flowering → Harvest.
- **FS-PLM-004**: Ведение полной истории вмешательств: подкормки, полив, обработка триходермой/бациллой, стимуляторы.
- **FS-PLM-005**: Генерация отчетов seed-to-sale для аудиторов с полной трассировкой партий и растений.

## 3.5 Training & Competency

- **FS-TRAIN-001**: В системе хранится база знаний, курсы и тесты.
- **FS-TRAIN-002**: Автоматическое создание аттестаций на должности с ограничением доступа к критическим функциям по уровню компетенции.
- **FS-TRAIN-003**: Отчеты об успешном прохождении курсов доступны в Audit Trail.

## 3.6 Disaster Recovery / Business Continuity

- **FS-DR-001**: Система построена на кластерной архитектуре с репликацией (Kubernetes, StatefulSets).
- **FS-DR-002**: Гео-репликация: минимум два дата-центра в разных регионах.
- **FS-DR-003**: Автоматизированный сценарий failover + тестирование 1 раз в год.
- **FS-DR-004**: Daily backup с хранением минимум 5 лет, шифрование резервов.

# 4. Acceptance Criteria

- Все FS требования должны быть покрыты IQ/OQ/PQ тестами.
- Маппинг на RTM: FS → URS.
- Полное покрытие Audit Trail, e-signature, disaster recovery, RBAC.

# 5. Glossary

- **WORM** — Write Once Read Many
- **RBAC** — Role-Based Access Control
- **Audit Trail** — неизменяемый журнал действий пользователей
- **QR-code/NFC e-signature** — подпись через сканирование бейджа QR или NFC
- **Seed-to-sale report** — отчёт с полной трассировкой растения или партии
